# –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
PROJECT_NAME = pascal-limacon
BUILD_DIR = dist
SRC_DIR = src
NODE_MODULES = node_modules
PACKAGE_JSON = package.json

# –¶–≤–µ—Ç–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞
RED = \033[0;31m
GREEN = \033[0;32m
YELLOW = \033[0;33m
BLUE = \033[0;34m
NC = \033[0m # No Color

# –ì–ª–∞–≤–Ω–∞—è —Ü–µ–ª—å
.PHONY: all
all: install build

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
.PHONY: install
install:
	@echo "$(BLUE)üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π...$(NC)"
	npm install
	@echo "$(GREEN)‚úÖ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã$(NC)"

# –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
.PHONY: dev
dev:
	@echo "$(BLUE)üöÄ –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏...$(NC)"
	npm run dev

# –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
.PHONY: build
build:
	@echo "$(BLUE)üî® –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞...$(NC)"
	npm run build
	@echo "$(GREEN)‚úÖ –ü—Ä–æ–µ–∫—Ç —Å–æ–±—Ä–∞–Ω –≤ $(BUILD_DIR)$(NC)"

# –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä —Å–±–æ—Ä–∫–∏
.PHONY: preview
preview: build
	@echo "$(BLUE)üëÄ –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä...$(NC)"
	npm run preview

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞
.PHONY: lint
lint:
	@echo "$(BLUE)üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞ —Å ESLint...$(NC)"
	npm run lint

# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –ª–∏–Ω—Ç–µ—Ä–∞
.PHONY: lint-fix
lint-fix:
	@echo "$(BLUE)üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –ª–∏–Ω—Ç–µ—Ä–∞...$(NC)"
	npm run lint -- --fix

# –û—á–∏—Å—Ç–∫–∞
.PHONY: clean
clean:
	@echo "$(YELLOW)üßπ –û—á–∏—Å—Ç–∫–∞ build –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏...$(NC)"
	rm -rf $(BUILD_DIR)
	@echo "$(GREEN)‚úÖ –û—á–∏—Å—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞$(NC)"

# –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ (–≤–∫–ª—é—á–∞—è node_modules)
.PHONY: clean-all
clean-all: clean
	@echo "$(YELLOW)üßπ –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ (–≤–∫–ª—é—á–∞—è node_modules)...$(NC)"
	rm -rf $(NODE_MODULES)
	rm -rf package-lock.json
	@echo "$(GREEN)‚úÖ –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞$(NC)"

# –°–æ–∑–¥–∞–Ω–∏–µ –∞—Ä—Ö–∏–≤–∞ –¥–ª—è —Å–¥–∞—á–∏
.PHONY: archive
archive: clean build
	@echo "$(BLUE)üì¶ –°–æ–∑–¥–∞–Ω–∏–µ –∞—Ä—Ö–∏–≤–∞ –¥–ª—è —Å–¥–∞—á–∏...$(NC)"
	mkdir -p submit/
	cp -r $(BUILD_DIR)/* submit/
	cp -r $(SRC_DIR) submit/
	cp $(PACKAGE_JSON) submit/
	cp README.md submit/
	cp -r docs/ submit/ 2>/dev/null || true
	tar -czf $(PROJECT_NAME)-submit.tar.gz submit/
	rm -rf submit/
	@echo "$(GREEN)‚úÖ –ê—Ä—Ö–∏–≤ —Å–æ–∑–¥–∞–Ω: $(PROJECT_NAME)-submit.tar.gz$(NC)"

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ (–µ—Å–ª–∏ –¥–æ–±–∞–≤–∏—Ç–µ)
.PHONY: test
test:
	@echo "$(BLUE)üß™ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤...$(NC)"
	npm test 2>/dev/null || echo "$(YELLOW)‚ö†Ô∏è  –¢–µ—Å—Ç—ã –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã$(NC)"

# –ê–Ω–∞–ª–∏–∑ —Ä–∞–∑–º–µ—Ä–∞ –±–∞–Ω–¥–ª–∞
.PHONY: analyze
analyze: build
	@echo "$(BLUE)üìä –ê–Ω–∞–ª–∏–∑ —Ä–∞–∑–º–µ—Ä–∞ –±–∞–Ω–¥–ª–∞...$(NC)"
	npx vite-bundle-analyzer $(BUILD_DIR)

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –Ω–∞ —É—è–∑–≤–∏–º–æ—Å—Ç–∏
.PHONY: audit
audit:
	@echo "$(BLUE)üîí –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —É—è–∑–≤–∏–º–æ—Å—Ç–∏...$(NC)"
	npm audit

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
.PHONY: update
update:
	@echo "$(BLUE)üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π...$(NC)"
	npm update

# –ü–æ–º–æ—â—å
.PHONY: help
help:
	@echo "$(BLUE)üìö –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:$(NC)"
	@echo "  $(GREEN)make install$(NC)     - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π"
	@echo "  $(GREEN)make dev$(NC)         - –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏"
	@echo "  $(GREEN)make build$(NC)       - –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞"
	@echo "  $(GREEN)make preview$(NC)     - –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä —Å–±–æ—Ä–∫–∏"
	@echo "  $(GREEN)make lint$(NC)        - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞"
	@echo "  $(GREEN)make lint-fix$(NC)    - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –ª–∏–Ω—Ç–µ—Ä–∞"
	@echo "  $(GREEN)make clean$(NC)       - –û—á–∏—Å—Ç–∫–∞ build –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏"
	@echo "  $(GREEN)make clean-all$(NC)   - –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞"
	@echo "  $(GREEN)make archive$(NC)     - –°–æ–∑–¥–∞–Ω–∏–µ –∞—Ä—Ö–∏–≤–∞ –¥–ª—è —Å–¥–∞—á–∏"
	@echo "  $(GREEN)make test$(NC)        - –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤"
	@echo "  $(GREEN)make analyze$(NC)     - –ê–Ω–∞–ª–∏–∑ —Ä–∞–∑–º–µ—Ä–∞ –±–∞–Ω–¥–ª–∞"
	@echo "  $(GREEN)make audit$(NC)       - –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —É—è–∑–≤–∏–º–æ—Å—Ç–∏"
	@echo "  $(GREEN)make update$(NC)      - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π"
